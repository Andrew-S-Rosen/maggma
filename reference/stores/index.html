



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for Maggma, a files-to-API data pipeline for scientific applications">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Stores - Maggma Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#maggma.stores.mongolike.JSONStore" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Maggma Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Maggma Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Stores
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/materialsproject/maggma/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Maggma Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Maggma Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/materialsproject/maggma/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../concepts/" title="Core Concepts" class="md-nav__link">
      Core Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/stores/" title="Using Stores" class="md-nav__link">
      Using Stores
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/simple_builder/" title="Writing a Builder" class="md-nav__link">
      Writing a Builder
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/advanced_builder/" title="Advanced Builders" class="md-nav__link">
      Advanced Builders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/running_builders/" title="Running a Builder Pipeline" class="md-nav__link">
      Running a Builder Pipeline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/map_builder/" title="Working with MapBuilder" class="md-nav__link">
      Working with MapBuilder
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/group_builder/" title="Working with GroupBuilder" class="md-nav__link">
      Working with GroupBuilder
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Core
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Core
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../core_store/" title="Store" class="md-nav__link">
      Store
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core_builder/" title="Builder" class="md-nav__link">
      Builder
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core_validator/" title="Validator" class="md-nav__link">
      Validator
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Stores
      </label>
    
    <a href="./" title="Stores" class="md-nav__link md-nav__link--active">
      Stores
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.JSONStore" class="md-nav__link">
    JSONStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.JSONStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.JSONStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.JSONStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore" class="md-nav__link">
    MemoryStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.__hash__" class="md-nav__link">
    __hash__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore" class="md-nav__link">
    MongoStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.__hash__" class="md-nav__link">
    __hash__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.from_collection" class="md-nav__link">
    from_collection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.from_db_file" class="md-nav__link">
    from_db_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoURIStore" class="md-nav__link">
    MongoURIStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoURIStore.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoURIStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoURIStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore" class="md-nav__link">
    GridFSStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.last_updated" class="md-nav__link">
    last_updated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.transform_criteria" class="md-nav__link">
    transform_criteria()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store" class="md-nav__link">
    AmazonS3Store
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.last_updated" class="md-nav__link">
    last_updated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.newer_in" class="md-nav__link">
    newer_in()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.rebuild_index_from_s3_data" class="md-nav__link">
    rebuild_index_from_s3_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore" class="md-nav__link">
    AliasingStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore" class="md-nav__link">
    MongograntStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.from_collection" class="md-nav__link">
    from_collection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.from_db_file" class="md-nav__link">
    from_db_file()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore" class="md-nav__link">
    SandboxStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.sbx_criteria" class="md-nav__link">
    sbx_criteria
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.VaultStore" class="md-nav__link">
    VaultStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.VaultStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.VaultStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore" class="md-nav__link">
    ConcatStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.last_updated" class="md-nav__link">
    last_updated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore" class="md-nav__link">
    JointStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.last_updated" class="md-nav__link">
    last_updated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.nonmaster_names" class="md-nav__link">
    nonmaster_names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.query_one" class="md-nav__link">
    query_one()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../builders/" title="Builders" class="md-nav__link">
      Builders
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.JSONStore" class="md-nav__link">
    JSONStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.JSONStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.JSONStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.JSONStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore" class="md-nav__link">
    MemoryStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.__hash__" class="md-nav__link">
    __hash__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MemoryStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore" class="md-nav__link">
    MongoStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.__hash__" class="md-nav__link">
    __hash__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.from_collection" class="md-nav__link">
    from_collection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.from_db_file" class="md-nav__link">
    from_db_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoURIStore" class="md-nav__link">
    MongoURIStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoURIStore.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoURIStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.mongolike.MongoURIStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore" class="md-nav__link">
    GridFSStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.last_updated" class="md-nav__link">
    last_updated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.transform_criteria" class="md-nav__link">
    transform_criteria()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.gridfs.GridFSStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store" class="md-nav__link">
    AmazonS3Store
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.last_updated" class="md-nav__link">
    last_updated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.newer_in" class="md-nav__link">
    newer_in()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.rebuild_index_from_s3_data" class="md-nav__link">
    rebuild_index_from_s3_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.aws.AmazonS3Store.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore" class="md-nav__link">
    AliasingStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.AliasingStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore" class="md-nav__link">
    MongograntStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.from_collection" class="md-nav__link">
    from_collection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.MongograntStore.from_db_file" class="md-nav__link">
    from_db_file()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore" class="md-nav__link">
    SandboxStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.sbx_criteria" class="md-nav__link">
    sbx_criteria
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.SandboxStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.VaultStore" class="md-nav__link">
    VaultStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.VaultStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.advanced_stores.VaultStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore" class="md-nav__link">
    ConcatStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.last_updated" class="md-nav__link">
    last_updated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.distinct" class="md-nav__link">
    distinct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.ConcatStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore" class="md-nav__link">
    JointStore
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.last_updated" class="md-nav__link">
    last_updated
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.nonmaster_names" class="md-nav__link">
    nonmaster_names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.connect" class="md-nav__link">
    connect()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.count" class="md-nav__link">
    count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.ensure_index" class="md-nav__link">
    ensure_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.groupby" class="md-nav__link">
    groupby()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.query" class="md-nav__link">
    query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.query_one" class="md-nav__link">
    query_one()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.remove_docs" class="md-nav__link">
    remove_docs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maggma.stores.compound_stores.JointStore.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/materialsproject/maggma/edit/master/docs/reference/stores.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Stores</h1>
                
                <p>Module containing various definitions of Stores.
Stores are a default access pattern to data and provide
various utillities</p>
<h2 id="maggma.stores.mongolike.JSONStore"><code class="codehilite"><span class="n">JSONStore</span></code><a class="headerlink" href="#maggma.stores.mongolike.JSONStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>A Store for access to a single or multiple JSON files</p>
<h3 id="maggma.stores.mongolike.JSONStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.JSONStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>472
473
474
475
476
477
478
479
480
481
482
483</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for JSONStore</span>

<span class="sd">        Args:</span>
<span class="sd">            other: other JSONStore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">JSONStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="s2">&quot;last_updated_field&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for JSONStore</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code>object</code></td>
<td>other JSONStore to compare with</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.JSONStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.JSONStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>446
447
448
449
450
451
452
453
454</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            paths: paths for json files to turn into a Store</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="k">else</span> <span class="p">[</span><span class="n">paths</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;collection&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>paths</code></td>
<td><code>Union[str, List[str]]</code></td>
<td>paths for json files to turn into a Store</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.JSONStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.JSONStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>456
457
458
459
460
461
462
463
464
465
466
467</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the files into the collection in memory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">force_reset</span><span class="o">=</span><span class="n">force_reset</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
                <span class="n">objects</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">objects</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">objects</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Loads the files into the collection in memory</p>
</div>
</div>
<h2 id="maggma.stores.mongolike.MemoryStore"><code class="codehilite"><span class="n">MemoryStore</span></code><a class="headerlink" href="#maggma.stores.mongolike.MemoryStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>An in-memory Store that functions similarly
to a MongoStore</p>
<h3 id="maggma.stores.mongolike.MemoryStore.name"><code class="codehilite"><span class="n">name</span><span class="p">:</span> <span class="n">_empty</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.mongolike.MemoryStore.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p>Name for the store </p>
</div>
<h3 id="maggma.stores.mongolike.MemoryStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MemoryStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>429
430
431
432
433
434
435
436
437
438</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for MemoryStore</span>
<span class="sd">        other: other MemoryStore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MemoryStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;collection_name&quot;</span><span class="p">,</span> <span class="s2">&quot;last_updated_field&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for MemoryStore
other: other MemoryStore to compare with</p>
</div>
<h3 id="maggma.stores.mongolike.MemoryStore.__hash__"><code class="codehilite"><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MemoryStore.__hash__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>385
386
387</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Hash for the store &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_updated_field</span><span class="p">))</span>
</pre></div>
</td></tr></table>

</details>
<p>Hash for the store </p>
</div>
<h3 id="maggma.stores.mongolike.MemoryStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s1">&#39;memory_db&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MemoryStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>362
363
364
365
366
367
368
369
370
371</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;memory_db&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the Memory Store</span>
<span class="sd">        Args:</span>
<span class="sd">            collection_name: name for the collection in memory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MongoStore</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># noqa</span>
</pre></div>
</td></tr></table>

</details>
<p>Initializes the Memory Store
<strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>collection_name</code></td>
<td><code>str</code></td>
<td>name for the collection in memory</td>
<td><code>'memory_db'</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MemoryStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MemoryStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>373
374
375
376
377
378</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to the source data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="ow">or</span> <span class="n">force_reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="n">mongomock</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()</span><span class="o">.</span><span class="n">db</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</pre></div>
</td></tr></table>

</details>
<p>Connect to the source data</p>
</div>
<h3 id="maggma.stores.mongolike.MemoryStore.groupby"><code class="codehilite"><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MemoryStore.groupby" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple grouping function that will group documents</span>
<span class="sd">        by keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            keys: fields to group documents</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            generator returning tuples of (key, list of elemnts)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">doc</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">has</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">grouping_keys</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">vals</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">grouping_keys</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">grouping_keys</span><span class="p">):</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[Any,Any]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
                <span class="n">set_</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">doc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Simple grouping function that will group documents
by keys.</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keys</code></td>
<td><code>Union[List[str], str]</code></td>
<td>fields to group documents</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Union[Dict, List, None]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Iterator[Tuple[Dict, List[Dict]]]</code></td>
<td>generator returning tuples of (key, list of elemnts)</td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="maggma.stores.mongolike.MongoStore"><code class="codehilite"><span class="n">MongoStore</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>A Store that connects to a Mongo collection</p>
<h3 id="maggma.stores.mongolike.MongoStore.name"><code class="codehilite"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p>Return a string representing this data source</p>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>305
306
307
308
309
310
311
312
313
314</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for MongoStore</span>
<span class="sd">        other: other mongostore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MongoStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="s2">&quot;collection_name&quot;</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;last_updated_field&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for MongoStore
other: other mongostore to compare with</p>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.__hash__"><code class="codehilite"><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.__hash__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>82
83
84</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Hash for MongoStore &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_updated_field</span><span class="p">))</span>
</pre></div>
</td></tr></table>

</details>
<p>Hash for MongoStore </p>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">27017</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">27017</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            database: The database name</span>
<span class="sd">            collection_name: The collection name</span>
<span class="sd">            host: Hostname for the database</span>
<span class="sd">            port: TCP port to connect to</span>
<span class="sd">            username: Username for the collection</span>
<span class="sd">            password: Password to connect with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Any</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>database</code></td>
<td><code>str</code></td>
<td>The database name</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>collection_name</code></td>
<td><code>str</code></td>
<td>The collection name</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>host</code></td>
<td><code>str</code></td>
<td>Hostname for the database</td>
<td><code>'localhost'</code></td>
</tr>
<tr>
<td><code>port</code></td>
<td><code>int</code></td>
<td>TCP port to connect to</td>
<td><code>27017</code></td>
</tr>
<tr>
<td><code>username</code></td>
<td><code>str</code></td>
<td>Username for the collection</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>password</code></td>
<td><code>str</code></td>
<td>Password to connect with</td>
<td><code>''</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.close"><code class="codehilite"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.close" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>301
302
303</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Close up all collections &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table>

</details>
<p>Close up all collections </p>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>71
72
73
74
75
76
77
78
79
80</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to the source data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="ow">or</span> <span class="n">force_reset</span><span class="p">:</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">]</span>
</pre></div>
</td></tr></table>

</details>
<p>Connect to the source data</p>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.count"><code class="codehilite"><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.count" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>187
188
189
190
191
192
193
194
195
196</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of documents matching the query criteria</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to count in</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span> <span class="k">if</span> <span class="n">criteria</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">count_documents</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Counts the number of documents matching the query criteria</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to count in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.distinct"><code class="codehilite"><span class="n">distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.distinct" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 99
100
101
102
103
104
105
106
107
108
109
110</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">distinct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all distinct values for a field</span>

<span class="sd">        Args:</span>
<span class="sd">            field: the field(s) to get distinct values for</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Get all distinct values for a field</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>field</code></td>
<td><code>str</code></td>
<td>the field(s) to get distinct values for</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.ensure_index"><code class="codehilite"><span class="n">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.ensure_index" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries to create an index and return true if it suceeded</span>
<span class="sd">        Args:</span>
<span class="sd">            key: single key to index</span>
<span class="sd">            unique: Whether or not this index contains only unique keys</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool indicating if the index exists/was created</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">confirm_field_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</td></tr></table>

</details>
<p>Tries to create an index and return true if it suceeded
<strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td><code>str</code></td>
<td>single key to index</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unique</code></td>
<td><code>Optional[bool]</code></td>
<td>Whether or not this index contains only unique keys</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>bool indicating if the index exists/was created</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.from_collection"><code class="codehilite"><span class="n">from_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span></code> <em>(classmethod)</em><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.from_collection" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_collection</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">collection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a MongoStore from a pymongo collection object</span>
<span class="sd">        This is not a fully safe operation as it gives dummy information to the MongoStore</span>
<span class="sd">        As a result, this will not serialize and can not reset its connection</span>

<span class="sd">        Args:</span>
<span class="sd">            collection: the PyMongo collection to create a MongoStore around</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: How do we make this safer?</span>
        <span class="n">coll_name</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">name</span>
        <span class="n">db_name</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">name</span>

        <span class="n">store</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">db_name</span><span class="p">,</span> <span class="n">coll_name</span><span class="p">)</span>
        <span class="n">store</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="n">collection</span>
        <span class="k">return</span> <span class="n">store</span>
</pre></div>
</td></tr></table>

</details>
<p>Generates a MongoStore from a pymongo collection object
This is not a fully safe operation as it gives dummy information to the MongoStore
As a result, this will not serialize and can not reset its connection</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>collection</code></td>
<td><code>_empty</code></td>
<td>the PyMongo collection to create a MongoStore around</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.from_db_file"><code class="codehilite"><span class="n">from_db_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code> <em>(classmethod)</em><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.from_db_file" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>86
87
88
89
90
91
92
93
94
95
96
97</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_db_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience method to construct MongoStore from db_file</span>
<span class="sd">        from old QueryEngine format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;collection&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;collection_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;collection&quot;</span><span class="p">)</span>
        <span class="c1"># Get rid of aliases from traditional query engine db docs</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;aliases&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Convenience method to construct MongoStore from db_file
from old QueryEngine format</p>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.groupby"><code class="codehilite"><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.groupby" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple grouping function that will group documents</span>
<span class="sd">        by keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            keys: fields to group documents</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            generator returning tuples of (key, list of docs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">criteria</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;$match&quot;</span><span class="p">:</span> <span class="n">criteria</span><span class="p">})</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;$project&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span> <span class="o">+</span> <span class="n">keys</span><span class="p">}})</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="s2">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
        <span class="n">group_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">letter</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{key}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">letter</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">keys</span><span class="p">)}</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$push&quot;</span><span class="p">:</span> <span class="s2">&quot;$$ROOT&quot;</span><span class="p">}}})</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">allowDiskUse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">id_doc</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str,Any]</span>
            <span class="k">for</span> <span class="n">letter</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">group_id</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">has</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">],</span> <span class="n">letter</span><span class="p">):</span>
                    <span class="n">set_</span><span class="p">(</span><span class="n">id_doc</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">][</span><span class="n">letter</span><span class="p">])</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">id_doc</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;docs&quot;</span><span class="p">])</span>
</pre></div>
</td></tr></table>

</details>
<p>Simple grouping function that will group documents
by keys.</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keys</code></td>
<td><code>Union[List[str], str]</code></td>
<td>fields to group documents</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Union[Dict, List, None]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Iterator[Tuple[Dict, List[Dict]]]</code></td>
<td>generator returning tuples of (key, list of docs)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.query"><code class="codehilite"><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.query" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Queries the Store for a set of documents</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">}</span>

        <span class="n">sort_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sort</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="k">if</span> <span class="n">sort</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
            <span class="nb">filter</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">sort_list</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">yield</span> <span class="n">d</span>
</pre></div>
</td></tr></table>

</details>
<p>Queries the Store for a set of documents</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Union[Dict, List, None]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.remove_docs"><code class="codehilite"><span class="n">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.remove_docs" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>292
293
294
295
296
297
298
299</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove docs matching the query dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: query dictionary to match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">delete_many</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Remove docs matching the query dictionary</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Dict</code></td>
<td>query dictionary to match</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MongoStore.update"><code class="codehilite"><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoStore.update" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update documents into the Store</span>

<span class="sd">        Args:</span>
<span class="sd">            docs: the document or list of documents to update</span>
<span class="sd">            key: field name(s) to determine uniqueness for a</span>
<span class="sd">                 document, can be a list of multiple fields,</span>
<span class="sd">                 a single field, or None if the Store&#39;s key</span>
<span class="sd">                 field is to be used</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">docs</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">jsanitize</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">allow_bson</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># document-level validation is optional</span>
            <span class="n">validates</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">:</span>
                <span class="n">validates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">validates</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="o">.</span><span class="n">strict</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="o">.</span><span class="n">validation_errors</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="o">.</span><span class="n">validation_errors</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">validates</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">search_doc</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">search_doc</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]}</span>

                <span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReplaceOne</span><span class="p">(</span><span class="n">search_doc</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">upsert</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">requests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">bulk_write</span><span class="p">(</span><span class="n">requests</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Update documents into the Store</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docs</code></td>
<td><code>Union[List[Dict], Dict]</code></td>
<td>the document or list of documents to update</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code>Union[List, str, None]</code></td>
<td>field name(s) to determine uniqueness for a document, can be a list of multiple fields, a single field, or None if the Store's key field is to be used</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="maggma.stores.mongolike.MongoURIStore"><code class="codehilite"><span class="n">MongoURIStore</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoURIStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>A Store that connects to a Mongo collection via a URI
This is expected to be a special mongodb+srv:// URIs that include
client parameters via TXT records</p>
<h3 id="maggma.stores.mongolike.MongoURIStore.name"><code class="codehilite"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.mongolike.MongoURIStore.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p>Return a string representing this data source</p>
</div>
<h3 id="maggma.stores.mongolike.MongoURIStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoURIStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>324
325
326
327
328
329
330
331
332
333
334
335
336</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            uri: MongoDB+SRV URI</span>
<span class="sd">            database: database to connect to</span>
<span class="sd">            collection_name: The collection name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="n">uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MongoStore</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>uri</code></td>
<td><code>str</code></td>
<td>MongoDB+SRV URI</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>database</code></td>
<td><code>str</code></td>
<td>database to connect to</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>collection_name</code></td>
<td><code>str</code></td>
<td>The collection name</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.mongolike.MongoURIStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.mongolike.MongoURIStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/mongolike.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>346
347
348
349
350
351
352
353</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to the source data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="ow">or</span> <span class="n">force_reset</span><span class="p">:</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">]</span>
</pre></div>
</td></tr></table>

</details>
<p>Connect to the source data</p>
<p>Module containing various definitions of Stores.
Stores are a default access pattern to data and provide
various utillities</p>
</div>
</div>
<h2 id="maggma.stores.gridfs.GridFSStore"><code class="codehilite"><span class="n">GridFSStore</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>A Store for GrdiFS backend. Provides a common access method consistent with other stores</p>
<h3 id="maggma.stores.gridfs.GridFSStore.last_updated"><code class="codehilite"><span class="n">last_updated</span><span class="p">:</span> <span class="n">datetime</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.last_updated" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p>Provides the most recent last_updated date time stamp from
the documents in this Store</p>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>349
350
351
352
353
354
355
356
357
358</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for GridFSStore</span>
<span class="sd">        other: other GridFSStore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GridFSStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="s2">&quot;collection_name&quot;</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for GridFSStore
other: other GridFSStore to compare with</p>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">27017</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">27017</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">compression</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a GrdiFS Store for binary data</span>
<span class="sd">        Args:</span>
<span class="sd">            database: database name</span>
<span class="sd">            collection_name: The name of the collection.</span>
<span class="sd">                This is the string portion before the GridFS extensions</span>
<span class="sd">            host: hostname for the database</span>
<span class="sd">            port: port to connec to</span>
<span class="sd">            username: username to connect as</span>
<span class="sd">            password: password to authenticate as</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Any</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># type: Set[str]</span>

        <span class="k">if</span> <span class="s2">&quot;key&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_id&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Initializes a GrdiFS Store for binary data
<strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>database</code></td>
<td><code>str</code></td>
<td>database name</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>collection_name</code></td>
<td><code>str</code></td>
<td>The name of the collection. This is the string portion before the GridFS extensions</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>host</code></td>
<td><code>str</code></td>
<td>hostname for the database</td>
<td><code>'localhost'</code></td>
</tr>
<tr>
<td><code>port</code></td>
<td><code>int</code></td>
<td>port to connec to</td>
<td><code>27017</code></td>
</tr>
<tr>
<td><code>username</code></td>
<td><code>str</code></td>
<td>username to connect as</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>password</code></td>
<td><code>str</code></td>
<td>password to authenticate as</td>
<td><code>''</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.close"><code class="codehilite"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.close" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>346
347</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table>

</details>
<p>Closes any connections</p>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to the source data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="ow">or</span> <span class="n">force_reset</span><span class="p">:</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="n">gridfs</span><span class="o">.</span><span class="n">GridFS</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_files_collection</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.files&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_files_store</span> <span class="o">=</span> <span class="n">MongoStore</span><span class="o">.</span><span class="n">from_collection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files_collection</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_files_store</span><span class="o">.</span><span class="n">last_updated_field</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;metadata.</span><span class="si">{self.last_updated_field}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_chunks_collection</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.chunks&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">)]</span>
</pre></div>
</td></tr></table>

</details>
<p>Connect to the source data</p>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.count"><code class="codehilite"><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.count" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>137
138
139
140
141
142
143
144
145
146
147</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of documents matching the query criteria</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to count in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_criteria</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files_store</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Counts the number of documents matching the query criteria</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to count in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.distinct"><code class="codehilite"><span class="n">distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.distinct" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">distinct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all distinct values for a field</span>

<span class="sd">        Args:</span>
<span class="sd">            field: the field(s) to get distinct values for</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform_criteria</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">criteria</span>
        <span class="p">)</span>

        <span class="n">field</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;metadata.</span><span class="si">{field}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files_collection_fields</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;metadata.&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">field</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files_store</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Get all distinct values for a field</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>field</code></td>
<td><code>str</code></td>
<td>the field(s) to get distinct values for</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.ensure_index"><code class="codehilite"><span class="n">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.ensure_index" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries to create an index and return true if it suceeded</span>
<span class="sd">        Currently operators on the GridFS files collection</span>
<span class="sd">        Args:</span>
<span class="sd">            key: single key to index</span>
<span class="sd">            unique: Whether or not this index contains only unique keys</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool indicating if the index exists/was created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Transform key for gridfs first</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files_collection_fields</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;metadata.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">confirm_field_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</td></tr></table>

</details>
<p>Tries to create an index and return true if it suceeded
Currently operators on the GridFS files collection
<strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td><code>str</code></td>
<td>single key to index</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unique</code></td>
<td><code>Optional[bool]</code></td>
<td>Whether or not this index contains only unique keys</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>bool indicating if the index exists/was created</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.groupby"><code class="codehilite"><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.groupby" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple grouping function that will group documents</span>
<span class="sd">        by keys. Will only work if the keys are included in the files</span>
<span class="sd">        collection for GridFS</span>

<span class="sd">        Args:</span>
<span class="sd">            keys: fields to group documents</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            generator returning tuples of (dict, list of docs)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform_criteria</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">criteria</span>
        <span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">keys</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;metadata.</span><span class="si">{k}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files_collection_fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;metadata.&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">k</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">ids</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files_store</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;metadata.</span><span class="si">{self.key}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">get</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;metadata.</span><span class="si">{self.key}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ids</span>
                <span class="k">if</span> <span class="n">has</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;metadata.</span><span class="si">{self.key}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">group</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;metadata.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="n">get</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">has</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">yield</span> <span class="n">group</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">criteria</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">ids</span><span class="p">}}))</span>
</pre></div>
</td></tr></table>

</details>
<p>Simple grouping function that will group documents
by keys. Will only work if the keys are included in the files
collection for GridFS</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keys</code></td>
<td><code>Union[List[str], str]</code></td>
<td>fields to group documents</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Union[Dict, List, None]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Iterator[Tuple[Dict, List[Dict]]]</code></td>
<td>generator returning tuples of (dict, list of docs)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.name"><code class="codehilite"><span class="n">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>84
85
86
87
88</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string representing this data source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;gridfs://</span><span class="si">{self.host}</span><span class="s2">/</span><span class="si">{self.database}</span><span class="s2">/</span><span class="si">{self.collection_name}</span><span class="s2">&quot;</span>
</pre></div>
</td></tr></table>

</details>
<p>Return a string representing this data source</p>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.query"><code class="codehilite"><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.query" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Queries the GridFS Store for a set of documents</span>
<span class="sd">        Currently ignores properties</span>

<span class="sd">        TODO: If properties wholy in metadata, just query that</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_criteria</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
            <span class="nb">filter</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sort</span>
        <span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">metadata</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">metadata</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;zlib&quot;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">yield</span> <span class="n">data</span>
</pre></div>
</td></tr></table>

</details>
<p>Queries the GridFS Store for a set of documents
Currently ignores properties</p>
<p>TODO: If properties wholy in metadata, just query that</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Union[Dict, List, None]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.remove_docs"><code class="codehilite"><span class="n">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.remove_docs" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>332
333
334
335
336
337
338
339
340
341
342
343
344</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove docs matching the query dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: query dictionary to match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_criteria</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">cursor</span><span class="o">.</span><span class="n">_id</span> <span class="k">for</span> <span class="n">cursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">criteria</span><span class="p">)]</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Remove docs matching the query dictionary</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Dict</code></td>
<td>query dictionary to match</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.transform_criteria"><code class="codehilite"><span class="n">transform_criteria</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span></code> <em>(classmethod)</em><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.transform_criteria" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">transform_criteria</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allow client to not need to prepend &#39;metadata.&#39; to query fields.</span>
<span class="sd">        Args:</span>
<span class="sd">            criteria: Query criteria</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_criteria</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">criteria</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">files_collection_fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
                <span class="s2">&quot;metadata.&quot;</span>
            <span class="p">):</span>
                <span class="n">new_criteria</span><span class="p">[</span><span class="s2">&quot;metadata.&quot;</span> <span class="o">+</span> <span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">criteria</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_criteria</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">criteria</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">new_criteria</span>
</pre></div>
</td></tr></table>

</details>
<p>Allow client to not need to prepend 'metadata.' to query fields.
<strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Dict</code></td>
<td>Query criteria</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.gridfs.GridFSStore.update"><code class="codehilite"><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.gridfs.GridFSStore.update" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/gridfs.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update documents into the Store</span>

<span class="sd">        Args:</span>
<span class="sd">            docs: the document or list of documents to update</span>
<span class="sd">            key: field name(s) to determine uniqueness for a</span>
<span class="sd">                 document, can be a list of multiple fields,</span>
<span class="sd">                 a single field, or None if the Store&#39;s key</span>
<span class="sd">                 field is to be used</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">docs</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>

        <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_keys</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files_collection_fields</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">search_doc</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">}</span>

            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_updated_field</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">}</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">search_doc</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jsanitize</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;zlib&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
            <span class="n">search_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_criteria</span><span class="p">(</span><span class="n">search_doc</span><span class="p">)</span>

            <span class="c1"># Cleans up old gridfs entries</span>
            <span class="k">for</span> <span class="n">fdoc</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_files_collection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">search_doc</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;uploadDate&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fdoc</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">])</span>
</pre></div>
</td></tr></table>

</details>
<p>Update documents into the Store</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docs</code></td>
<td><code>Union[List[Dict], Dict]</code></td>
<td>the document or list of documents to update</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code>Union[List, str, None]</code></td>
<td>field name(s) to determine uniqueness for a document, can be a list of multiple fields, a single field, or None if the Store's key field is to be used</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Advanced Stores for connecting to AWS data</p>
</div>
</div>
<h2 id="maggma.stores.aws.AmazonS3Store"><code class="codehilite"><span class="n">AmazonS3Store</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>GridFS like storage using Amazon S3 and a regular store for indexing
Assumes Amazon AWS key and secret key are set in environment or default config file</p>
<h3 id="maggma.stores.aws.AmazonS3Store.last_updated"><code class="codehilite"><span class="n">last_updated</span><span class="p">:</span> <span class="n">_empty</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.last_updated" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p>Provides the most recent last_updated date time stamp from
the documents in this Store</p>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>299
300
301
302
303
304
305
306
307
308</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for AmazonS3Store</span>
<span class="sd">        other: other AmazonS3Store to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">AmazonS3Store</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;bucket&quot;</span><span class="p">,</span> <span class="s2">&quot;last_updated_field&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for AmazonS3Store
other: other AmazonS3Store to compare with</p>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Store</span><span class="p">,</span> <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">compress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an S3 Store</span>

<span class="sd">        Args:</span>
<span class="sd">            index: a store to use to index the S3 Bucket</span>
<span class="sd">            bucket: name of the bucket</span>
<span class="sd">            compress: compress files inserted into the store</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">boto3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;boto3 and botocore are required for AmazonS3Store&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">bucket</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compress</span> <span class="o">=</span> <span class="n">compress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Any</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Any</span>
        <span class="c1"># Force the key to be the same as the index</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">key</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AmazonS3Store</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Initializes an S3 Store</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>index</code></td>
<td><code>Store</code></td>
<td>a store to use to index the S3 Bucket</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>bucket</code></td>
<td><code>str</code></td>
<td>name of the bucket</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>compress</code></td>
<td><code>bool</code></td>
<td>compress files inserted into the store</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.close"><code class="codehilite"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.close" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>70
71
72
73
74
75
76</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes any connections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</td></tr></table>

</details>
<p>Closes any connections</p>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>57
58
59
60
61
62
63
64
65
66
67
68</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to the source data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">force_reset</span><span class="o">=</span><span class="n">force_reset</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">buckets</span><span class="o">.</span><span class="n">all</span><span class="p">()]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Bucket not present on AWS: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Connect to the source data</p>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.count"><code class="codehilite"><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.count" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>91
92
93
94
95
96
97
98
99</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of documents matching the query criteria</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to count in</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Counts the number of documents matching the query criteria</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to count in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.distinct"><code class="codehilite"><span class="n">distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.distinct" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>141
142
143
144
145
146
147
148
149
150
151
152</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">distinct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all distinct values for a field</span>

<span class="sd">        Args:</span>
<span class="sd">            field: the field(s) to get distinct values for</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Index is a store so it should have its own distinct function</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Get all distinct values for a field</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>field</code></td>
<td><code>str</code></td>
<td>the field(s) to get distinct values for</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.ensure_index"><code class="codehilite"><span class="n">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.ensure_index" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>187
188
189
190
191
192
193
194
195
196
197
198</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries to create an index and return true if it suceeded</span>

<span class="sd">        Args:</span>
<span class="sd">            key: single key to index</span>
<span class="sd">            unique: Whether or not this index contains only unique keys</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool indicating if the index exists/was created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ensure_index</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Tries to create an index and return true if it suceeded</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td><code>str</code></td>
<td>single key to index</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unique</code></td>
<td><code>bool</code></td>
<td>Whether or not this index contains only unique keys</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>bool indicating if the index exists/was created</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.groupby"><code class="codehilite"><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.groupby" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple grouping function that will group documents</span>
<span class="sd">        by keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            keys: fields to group documents</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            generator returning tuples of (dict, list of docs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
            <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
            <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Simple grouping function that will group documents
by keys.</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keys</code></td>
<td><code>Union[List[str], str]</code></td>
<td>fields to group documents</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Iterator[Tuple[Dict, List[Dict]]]</code></td>
<td>generator returning tuples of (dict, list of docs)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.name"><code class="codehilite"><span class="n">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>50
51
52
53
54
55</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            a string representing this data source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{self.bucket}</span><span class="s2">&quot;</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>str</code></td>
<td>a string representing this data source</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.newer_in"><code class="codehilite"><span class="n">newer_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exhaustive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.newer_in" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">newer_in</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Store</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exhaustive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the keys of documents that are newer in the target</span>
<span class="sd">        Store than this Store.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: target Store</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            exhaustive: triggers an item-by-item check vs. checking</span>
<span class="sd">                        the last_updated of the target Store and using</span>
<span class="sd">                        that to filter out new items in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">newer_in</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">exhaustive</span><span class="o">=</span><span class="n">exhaustive</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Returns the keys of documents that are newer in the target
Store than this Store.</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>target</code></td>
<td><code>Store</code></td>
<td>target Store</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>exhaustive</code></td>
<td><code>bool</code></td>
<td>triggers an item-by-item check vs. checking the last_updated of the target Store and using that to filter out new items in</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.query"><code class="codehilite"><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.query" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Queries the Store for a set of documents</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># TODO: THis is ugly and unsafe, do some real checking before pulling data</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s2">&quot;Body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">botocore</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># If a client error is thrown, then check that it was a 404 error.</span>
                <span class="c1"># If it was a 404 error, then the object does not exist.</span>
                <span class="n">error_code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;Error&quot;</span><span class="p">][</span><span class="s2">&quot;Code&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">error_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Could not find S3 object </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">])</span>
                    <span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>

            <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;zlib&quot;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Queries the Store for a set of documents</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.rebuild_index_from_s3_data"><code class="codehilite"><span class="n">rebuild_index_from_s3_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.rebuild_index_from_s3_data" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>287
288
289
290
291
292
293
294
295
296
297</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">rebuild_index_from_s3_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rebuilds the index Store from the data in S3</span>
<span class="sd">        Relies on the index document being stores as the metadata for the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index_docs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="c1"># TODO: Transform the data back from strings and remove AWS S3 specific keys</span>
            <span class="n">index_docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">index_docs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Rebuilds the index Store from the data in S3
Relies on the index document being stores as the metadata for the file</p>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.remove_docs"><code class="codehilite"><span class="n">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">,</span> <span class="n">remove_s3_object</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.remove_docs" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">remove_s3_object</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove docs matching the query dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: query dictionary to match</span>
<span class="sd">            remove_s3_object: whether to remove the actual S3 Object or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">remove_s3_object</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">remove_docs</span><span class="p">(</span><span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_remove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">remove_docs</span><span class="p">(</span><span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>

            <span class="c1"># Can remove up to 1000 items at a time via boto</span>
            <span class="n">to_remove_chunks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">grouper</span><span class="p">(</span><span class="n">to_remove</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">chunk_to_remove</span> <span class="ow">in</span> <span class="n">to_remove_chunks</span><span class="p">:</span>
                <span class="n">objlist</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="p">}</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">chunk_to_remove</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span><span class="o">.</span><span class="n">delete_objects</span><span class="p">(</span><span class="n">Delete</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Objects&quot;</span><span class="p">:</span> <span class="n">objlist</span><span class="p">})</span>
</pre></div>
</td></tr></table>

</details>
<p>Remove docs matching the query dictionary</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Dict</code></td>
<td>query dictionary to match</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>remove_s3_object</code></td>
<td><code>bool</code></td>
<td>whether to remove the actual S3 Object or not</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.aws.AmazonS3Store.update"><code class="codehilite"><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.aws.AmazonS3Store.update" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/aws.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update documents into the Store</span>

<span class="sd">        Args:</span>
<span class="sd">            docs: the document or list of documents to update</span>
<span class="sd">            key: field name(s) to determine uniqueness for a</span>
<span class="sd">                 document, can be a list of multiple fields,</span>
<span class="sd">                 a single field, or None if the Store&#39;s key</span>
<span class="sd">                 field is to be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">search_docs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">search_keys</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">search_keys</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">elif</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">search_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">search_keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">search_doc</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">search_keys</span><span class="p">}</span>
            <span class="n">search_doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># Ensure key is in metadata</span>

            <span class="c1"># Remove MongoDB _id from search</span>
            <span class="k">if</span> <span class="s2">&quot;_id&quot;</span> <span class="ow">in</span> <span class="n">search_doc</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">search_doc</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">]</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jsanitize</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

            <span class="c1"># Compress with zlib if chosen</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress</span><span class="p">:</span>
                <span class="n">search_doc</span><span class="p">[</span><span class="s2">&quot;compression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;zlib&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">s3_bucket</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span><span class="n">Key</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">Body</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">Metadata</span><span class="o">=</span><span class="n">search_doc</span><span class="p">)</span>
            <span class="n">search_docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search_doc</span><span class="p">)</span>

        <span class="c1"># Use store&#39;s update to remove key clashes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">search_docs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Update documents into the Store</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docs</code></td>
<td><code>Union[List[Dict], Dict]</code></td>
<td>the document or list of documents to update</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code>Optional[Union[List, str]]</code></td>
<td>field name(s) to determine uniqueness for a document, can be a list of multiple fields, a single field, or None if the Store's key field is to be used</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>Advanced Stores for behavior outside normal access patterns</p>
</div>
</div>
<h2 id="maggma.stores.advanced_stores.AliasingStore"><code class="codehilite"><span class="n">AliasingStore</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>Special Store that aliases for the primary accessors</p>
<h3 id="maggma.stores.advanced_stores.AliasingStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>370
371
372
373
374
375
376
377
378
379
380
381</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for AliasingStore</span>

<span class="sd">        Args:</span>
<span class="sd">            other: other AliasingStore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">AliasingStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="s2">&quot;aliases&quot;</span><span class="p">,</span> <span class="s2">&quot;last_updated_field&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for AliasingStore</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code>object</code></td>
<td>other AliasingStore to compare with</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">aliases</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="n">Store</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            store: the store to wrap around</span>
<span class="sd">            aliases: dict of aliases of the form external key: internal key</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">store</span>
        <span class="c1"># Given an external key tells what the internal key is</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span> <span class="o">=</span> <span class="n">aliases</span>
        <span class="c1"># Given the internal key tells us what the external key is</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse_aliases</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;last_updated_field&quot;</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">last_updated_field</span><span class="p">,</span>
                <span class="s2">&quot;last_updated_type&quot;</span><span class="p">:</span> <span class="n">store</span><span class="o">.</span><span class="n">last_updated_type</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AliasingStore</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code>Store</code></td>
<td>the store to wrap around</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>aliases</code></td>
<td><code>Dict</code></td>
<td>dict of aliases of the form external key: internal key</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.close"><code class="codehilite"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.close" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>360
361</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table>

</details>
<p>Closes any connections</p>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>367
368</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">force_reset</span><span class="o">=</span><span class="n">force_reset</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Connect to the source data</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>force_reset</code></td>
<td><code>_empty</code></td>
<td>whether to reset the connection or not</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.count"><code class="codehilite"><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.count" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>226
227
228
229
230
231
232
233
234
235</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of documents matching the query criteria</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to count in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span> <span class="k">if</span> <span class="n">criteria</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="n">lazy_substitute</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_aliases</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Counts the number of documents matching the query criteria</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to count in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.distinct"><code class="codehilite"><span class="n">distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.distinct" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>268
269
270
271
272
273
274
275
276
277
278
279
280
281
282</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">distinct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all distinct values for a field</span>

<span class="sd">        Args:</span>
<span class="sd">            field: the field(s) to get distinct values for</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span> <span class="k">if</span> <span class="n">criteria</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="n">lazy_substitute</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_aliases</span><span class="p">)</span>

        <span class="c1"># substitute forward</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Get all distinct values for a field</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>field</code></td>
<td><code>str</code></td>
<td>the field(s) to get distinct values for</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.ensure_index"><code class="codehilite"><span class="n">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.ensure_index" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>355
356
357
358</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">ensure_index</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Tries to create an index and return true if it suceeded</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td><code>_empty</code></td>
<td>single key to index</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unique</code></td>
<td><code>_empty</code></td>
<td>Whether or not this index contains only unique keys</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_empty</code></td>
<td>bool indicating if the index exists/was created</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.groupby"><code class="codehilite"><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.groupby" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple grouping function that will group documents</span>
<span class="sd">        by keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            keys: fields to group documents</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            generator returning tuples of (dict, list of docs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert to a list</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>

        <span class="c1"># Make the aliasing transformations on keys</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span> <span class="k">else</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>

        <span class="c1"># Update criteria and properties based on aliases</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span> <span class="k">if</span> <span class="n">criteria</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="n">substitute</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_aliases</span><span class="p">)</span>
        <span class="n">lazy_substitute</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_aliases</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Simple grouping function that will group documents
by keys.</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keys</code></td>
<td><code>Union[List[str], str]</code></td>
<td>fields to group documents</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Iterator[Tuple[Dict, List[Dict]]]</code></td>
<td>generator returning tuples of (dict, list of docs)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.name"><code class="codehilite"><span class="n">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>220
221
222
223
224</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string representing this data source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</td></tr></table>

</details>
<p>Return a string representing this data source</p>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.query"><code class="codehilite"><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.query" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Queries the Store for a set of documents</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">}</span>

        <span class="n">criteria</span> <span class="o">=</span> <span class="n">criteria</span> <span class="k">if</span> <span class="n">criteria</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="n">substitute</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_aliases</span><span class="p">)</span>
        <span class="n">lazy_substitute</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_aliases</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span>
        <span class="p">):</span>
            <span class="n">substitute</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">d</span>
</pre></div>
</td></tr></table>

</details>
<p>Queries the Store for a set of documents</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.remove_docs"><code class="codehilite"><span class="n">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.remove_docs" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>344
345
346
347
348
349
350
351
352
353</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove docs matching the query dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: query dictionary to match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update criteria and properties based on aliases</span>
        <span class="n">lazy_substitute</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_aliases</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">remove_docs</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Remove docs matching the query dictionary</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Dict</code></td>
<td>query dictionary to match</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.AliasingStore.update"><code class="codehilite"><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.AliasingStore.update" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update documents into the Store</span>

<span class="sd">        Args:</span>
<span class="sd">            docs: the document or list of documents to update</span>
<span class="sd">            key: field name(s) to determine uniqueness for a</span>
<span class="sd">                 document, can be a list of multiple fields,</span>
<span class="sd">                 a single field, or None if the Store&#39;s key</span>
<span class="sd">                 field is to be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="k">if</span> <span class="n">key</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">substitute</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_aliases</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Update documents into the Store</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docs</code></td>
<td><code>Union[List[Dict], Dict]</code></td>
<td>the document or list of documents to update</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code>Optional[Union[List, str]]</code></td>
<td>field name(s) to determine uniqueness for a document, can be a list of multiple fields, a single field, or None if the Store's key field is to be used</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="maggma.stores.advanced_stores.MongograntStore"><code class="codehilite"><span class="n">MongograntStore</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.MongograntStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>Initialize a Store with a mongogrant "<role>:<host>/<db>." spec.</p>
<div class="codehilite"><pre><span></span>Some class methods of MongoStore, e.g. from_db_file and from_collection,
are not supported.

mongogrant documentation: https://github.com/materialsproject/mongogrant
</pre></div>


<h3 id="maggma.stores.advanced_stores.MongograntStore.name"><code class="codehilite"><span class="n">name</span><span class="p">:</span> <span class="n">_empty</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.advanced_stores.MongograntStore.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p>Return a string representing this data source</p>
</div>
<h3 id="maggma.stores.advanced_stores.MongograntStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.MongograntStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for MongograntStore</span>

<span class="sd">        Args:</span>
<span class="sd">            other: other MongograntStore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MongograntStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;mongogrant_spec&quot;</span><span class="p">,</span>
            <span class="s2">&quot;collection_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mgclient_config_path&quot;</span><span class="p">,</span>
            <span class="s2">&quot;last_updated_field&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for MongograntStore</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code>object</code></td>
<td>other MongograntStore to compare with</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.MongograntStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongogrant_spec</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">mgclient_config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.MongograntStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mongogrant_spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mgclient_config_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            mongogrant_spec: of the form &lt;role&gt;:&lt;host&gt;/&lt;db&gt;, where</span>
<span class="sd">                role is one of {&quot;read&quot;, &quot;readWrite&quot;} or aliases {&quot;ro&quot;, &quot;rw&quot;};</span>
<span class="sd">                host is a db host (w/ optional port) or alias; and db is a db</span>
<span class="sd">                on that host, or alias. See mongogrant documentation.</span>
<span class="sd">            collection_name: name of mongo collection</span>
<span class="sd">            mgclient_config_path: Path to mongogrant client config file,</span>
<span class="sd">               or None if default path (`mongogrant.client.path`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongogrant_spec</span> <span class="o">=</span> <span class="n">mongogrant_spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mgclient_config_path</span> <span class="o">=</span> <span class="n">mgclient_config_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">StoreError</span><span class="p">(</span>
                <span class="s2">&quot;MongograntStore does not accept &quot;</span>
                <span class="s2">&quot;username, password, database, or host &quot;</span>
                <span class="s2">&quot;arguments. Use `mongogrant_spec`.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MongoStore</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># noqa</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mongogrant_spec</code></td>
<td><code>str</code></td>
<td _readWrite_="&quot;readWrite&quot;" _read_="&quot;read&quot;,">of the form <role>:<host>/<db>, where role is one of </td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>collection_name</code></td>
<td><code>str</code></td>
<td>name of mongo collection</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mgclient_config_path</code></td>
<td><code>Optional[str]</code></td>
<td>Path to mongogrant client config file, or None if default path (<code>mongogrant.client.path</code>).</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.MongograntStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.MongograntStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to the mongogrant source</span>

<span class="sd">        Args:</span>
<span class="sd">            force_reset: forces the connection to reset rather than just</span>
<span class="sd">                         ensuring the connection is present</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="ow">or</span> <span class="n">force_reset</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mgclient_config_path</span><span class="p">:</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">check</span><span class="o">=</span><span class="n">check</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mgclient_config_path</span><span class="p">)</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mongogrant_spec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span><span class="p">]</span>
</pre></div>
</td></tr></table>

</details>
<p>Connect to the mongogrant source</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>force_reset</code></td>
<td><code>bool</code></td>
<td>forces the connection to reset rather than just ensuring the connection is present</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.MongograntStore.from_collection"><code class="codehilite"><span class="n">from_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span></code> <em>(classmethod)</em><a class="headerlink" href="#maggma.stores.advanced_stores.MongograntStore.from_collection" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_collection</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">collection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raises ValueError since MongograntStores can&#39;t be initialized from a PyMongo collection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MongograntStore doesn&#39;t implement from_collection&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Raises ValueError since MongograntStores can't be initialized from a PyMongo collection</p>
</div>
<h3 id="maggma.stores.advanced_stores.MongograntStore.from_db_file"><code class="codehilite"><span class="n">from_db_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></code> <em>(classmethod)</em><a class="headerlink" href="#maggma.stores.advanced_stores.MongograntStore.from_db_file" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>88
89
90
91
92
93</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_db_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raises ValueError since MongograntStores can&#39;t be initialized from a file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MongograntStore doesn&#39;t implement from_db_file&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Raises ValueError since MongograntStores can't be initialized from a file</p>
</div>
</div>
<h2 id="maggma.stores.advanced_stores.SandboxStore"><code class="codehilite"><span class="n">SandboxStore</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>Provides a sandboxed view to another store</p>
<h3 id="maggma.stores.advanced_stores.SandboxStore.sbx_criteria"><code class="codehilite"><span class="n">sbx_criteria</span><span class="p">:</span> <span class="n">Dict</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.sbx_criteria" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Dict</code></td>
<td>the sandbox criteria dict used to filter the source store</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>540
541
542
543
544
545
546
547
548
549
550
551</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for SandboxStore</span>

<span class="sd">        Args:</span>
<span class="sd">            other: other SandboxStore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SandboxStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="s2">&quot;sandbox&quot;</span><span class="p">,</span> <span class="s2">&quot;last_updated_field&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for SandboxStore</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code>object</code></td>
<td>other SandboxStore to compare with</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">sandbox</span><span class="p">,</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">:</span> <span class="n">Store</span><span class="p">,</span> <span class="n">sandbox</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            store: store to wrap sandboxing around</span>
<span class="sd">            sandbox: the corresponding sandbox</span>
<span class="sd">            exclusive: whether to be exclusively in this sandbox or include global items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sandbox</span> <span class="o">=</span> <span class="n">sandbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="n">exclusive</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
            <span class="n">last_updated_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">last_updated_field</span><span class="p">,</span>
            <span class="n">last_updated_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">last_updated_type</span><span class="p">,</span>
            <span class="n">validator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">validator</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>store</code></td>
<td><code>Store</code></td>
<td>store to wrap sandboxing around</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>sandbox</code></td>
<td><code>str</code></td>
<td>the corresponding sandbox</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>exclusive</code></td>
<td><code>bool</code></td>
<td>whether to be exclusively in this sandbox or include global items</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.close"><code class="codehilite"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.close" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>530
531</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table>

</details>
<p>Closes any connections</p>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>537
538</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">force_reset</span><span class="o">=</span><span class="n">force_reset</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Connect to the source data</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>force_reset</code></td>
<td><code>_empty</code></td>
<td>whether to reset the connection or not</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.count"><code class="codehilite"><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.count" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>426
427
428
429
430
431
432
433
434
435
436</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of documents matching the query criteria</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to count in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">criteria</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sbx_criteria</span><span class="p">)</span> <span class="k">if</span> <span class="n">criteria</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbx_criteria</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Counts the number of documents matching the query criteria</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to count in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.ensure_index"><code class="codehilite"><span class="n">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.ensure_index" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>527
528</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">ensure_index</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Tries to create an index and return true if it suceeded</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td><code>_empty</code></td>
<td>single key to index</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unique</code></td>
<td><code>_empty</code></td>
<td>Whether or not this index contains only unique keys</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_empty</code></td>
<td>bool indicating if the index exists/was created</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.groupby"><code class="codehilite"><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.groupby" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple grouping function that will group documents</span>
<span class="sd">        by keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            keys: fields to group documents</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            generator returning tuples of (dict, list of docs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">criteria</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sbx_criteria</span><span class="p">)</span> <span class="k">if</span> <span class="n">criteria</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbx_criteria</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Simple grouping function that will group documents
by keys.</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keys</code></td>
<td><code>Union[List[str], str]</code></td>
<td>fields to group documents</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Iterator[Tuple[Dict, List[Dict]]]</code></td>
<td>generator returning tuples of (dict, list of docs)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.name"><code class="codehilite"><span class="n">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>406
407
408
409
410
411</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            a string representing this data source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Sandbox[</span><span class="si">{self.store.name}</span><span class="s2">][</span><span class="si">{self.sandbox}</span><span class="s2">]&quot;</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>str</code></td>
<td>a string representing this data source</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.query"><code class="codehilite"><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.query" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Queries the Store for a set of documents</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">criteria</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sbx_criteria</span><span class="p">)</span> <span class="k">if</span> <span class="n">criteria</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbx_criteria</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Queries the Store for a set of documents</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.remove_docs"><code class="codehilite"><span class="n">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.remove_docs" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>514
515
516
517
518
519
520
521
522
523
524
525</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove docs matching the query dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: query dictionary to match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update criteria and properties based on aliases</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">criteria</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sbx_criteria</span><span class="p">)</span> <span class="k">if</span> <span class="n">criteria</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbx_criteria</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">remove_docs</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Remove docs matching the query dictionary</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Dict</code></td>
<td>query dictionary to match</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.SandboxStore.update"><code class="codehilite"><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.SandboxStore.update" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update documents into the Store</span>

<span class="sd">        Args:</span>
<span class="sd">            docs: the document or list of documents to update</span>
<span class="sd">            key: field name(s) to determine uniqueness for a</span>
<span class="sd">                 document, can be a list of multiple fields,</span>
<span class="sd">                 a single field, or None if the Store&#39;s key</span>
<span class="sd">                 field is to be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;sbxn&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sbxn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;sbxn&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sandbox</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sbxn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sandbox</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Update documents into the Store</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docs</code></td>
<td><code>Union[List[Dict], Dict]</code></td>
<td>the document or list of documents to update</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code>Optional[Union[List, str]]</code></td>
<td>field name(s) to determine uniqueness for a document, can be a list of multiple fields, a single field, or None if the Store's key field is to be used</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="maggma.stores.advanced_stores.VaultStore"><code class="codehilite"><span class="n">VaultStore</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.VaultStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>Extends MongoStore to read credentials out of Vault server
and uses these values to initialize MongoStore instance</p>
<h3 id="maggma.stores.advanced_stores.VaultStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.VaultStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>180
181
182
183
184
185
186
187
188
189
190
191</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for VaultStore</span>

<span class="sd">        Args:</span>
<span class="sd">            other: other VaultStore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VaultStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;vault_secret_path&quot;</span><span class="p">,</span> <span class="s2">&quot;collection_name&quot;</span><span class="p">,</span> <span class="s2">&quot;last_updated_field&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for VaultStore</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code>object</code></td>
<td>other VaultStore to compare with</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.advanced_stores.VaultStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">vault_secret_path</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.advanced_stores.VaultStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/advanced_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="nd">@requires</span><span class="p">(</span><span class="n">hvac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;hvac is required to use VaultStore&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vault_secret_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            collection_name: name of mongo collection</span>
<span class="sd">            vault_secret_path: path on vault server with mongo creds object</span>

<span class="sd">        Important:</span>
<span class="sd">            Environment variables that must be set prior to invocation</span>
<span class="sd">            VAULT_ADDR - URL of vault server (eg. https://matgen8.lbl.gov:8200)</span>
<span class="sd">            VAULT_TOKEN or GITHUB_TOKEN - token used to authenticate to vault</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vault_secret_path</span> <span class="o">=</span> <span class="n">vault_secret_path</span>

        <span class="c1"># TODO: Switch this over to Pydantic ConfigSettings</span>
        <span class="n">vault_addr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;VAULT_ADDR&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">vault_addr</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;VAULT_ADDR not set&quot;</span><span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="n">hvac</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">vault_addr</span><span class="p">)</span>

        <span class="c1"># If we have a vault token use this</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;VAULT_TOKEN&quot;</span><span class="p">)</span>

        <span class="c1"># Look for a github token instead</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
            <span class="n">github_token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GITHUB_TOKEN&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">github_token</span><span class="p">:</span>
                <span class="n">client</span><span class="o">.</span><span class="n">auth_github</span><span class="p">(</span><span class="n">github_token</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;VAULT_TOKEN or GITHUB_TOKEN not set&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Bad token&quot;</span><span class="p">)</span>

        <span class="c1"># Read the vault secret</span>
        <span class="n">json_db_creds</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">vault_secret_path</span><span class="p">)</span>
        <span class="n">db_creds</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_db_creds</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">db_creds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;db&quot;</span><span class="p">)</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">db_creds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">db_creds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">db_creds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">db_creds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">VaultStore</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">database</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>collection_name</code></td>
<td><code>str</code></td>
<td>name of mongo collection</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>vault_secret_path</code></td>
<td><code>str</code></td>
<td>path on vault server with mongo creds object</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Environment variables that must be set prior to invocation
VAULT_ADDR - URL of vault server (eg. https://matgen8.lbl.gov:8200)
VAULT_TOKEN or GITHUB_TOKEN - token used to authenticate to vault</p>
</div>
<p>Special stores that combine underlying Stores together </p>
</div>
</div>
<h2 id="maggma.stores.compound_stores.ConcatStore"><code class="codehilite"><span class="n">ConcatStore</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>Store concatting multiple stores</p>
<h3 id="maggma.stores.compound_stores.ConcatStore.last_updated"><code class="codehilite"><span class="n">last_updated</span><span class="p">:</span> <span class="n">datetime</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.last_updated" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p>Finds the most recent last_updated across all the stores.
This might not be the most usefull way to do this for this type of Store
since it could very easily over-estimate the last_updated based on what stores
are used</p>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>512
513
514
515
516
517
518
519
520
521
522
523</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for ConcatStore</span>

<span class="sd">        Args:</span>
<span class="sd">            other: other JointStore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ConcatStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;stores&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for ConcatStore</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code>object</code></td>
<td>other JointStore to compare with</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">stores</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>320
321
322
323
324
325
326
327
328
329</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">stores</span><span class="p">:</span> <span class="n">Store</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a ConcatStore that concatenates multiple stores together</span>
<span class="sd">        to appear as one store</span>

<span class="sd">        Args:</span>
<span class="sd">            stores: list of stores to concatenate together</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stores</span> <span class="o">=</span> <span class="n">stores</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConcatStore</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Initialize a ConcatStore that concatenates multiple stores together
to appear as one store</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*stores</code></td>
<td><code>Store</code></td>
<td>list of stores to concatenate together</td>
<td><code>()</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.close"><code class="codehilite"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.close" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>348
349
350
351
352
353</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close all connections in this ConcatStore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stores</span><span class="p">:</span>
            <span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table>

</details>
<p>Close all connections in this ConcatStore</p>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>338
339
340
341
342
343
344
345
346</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect all stores in this ConcatStore</span>

<span class="sd">        Args:</span>
<span class="sd">            force_reset: Whether to forcibly reset the connection for all stores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stores</span><span class="p">:</span>
            <span class="n">store</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">force_reset</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Connect all stores in this ConcatStore</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>force_reset</code></td>
<td><code>bool</code></td>
<td>Whether to forcibly reset the connection for all stores</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.count"><code class="codehilite"><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.count" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>417
418
419
420
421
422
423
424
425
426</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of documents matching the query criteria</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to count in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">store</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span> <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stores</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Counts the number of documents matching the query criteria</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to count in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.distinct"><code class="codehilite"><span class="n">distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.distinct" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>388
389
390
391
392
393
394
395
396
397
398
399
400
401
402</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">distinct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">all_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all distinct values for a field</span>

<span class="sd">        Args:</span>
<span class="sd">            field: the field(s) to get distinct values for</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">distincts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stores</span><span class="p">:</span>
            <span class="n">distincts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">store</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">distincts</span><span class="p">))</span>
</pre></div>
</td></tr></table>

</details>
<p>Get all distinct values for a field</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>field</code></td>
<td><code>str</code></td>
<td>the field(s) to get distinct values for</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.ensure_index"><code class="codehilite"><span class="n">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.ensure_index" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>404
405
406
407
408
409
410
411
412
413
414
415</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure an index is properly set. Returns whether all stores support this index or not</span>

<span class="sd">        Args:</span>
<span class="sd">            key: single key to index</span>
<span class="sd">            unique: Whether or not this index contains only unique keys</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool indicating if the index exists/was created on all stores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">store</span><span class="o">.</span><span class="n">ensure_index</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="p">)</span> <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stores</span><span class="p">])</span>
</pre></div>
</td></tr></table>

</details>
<p>Ensure an index is properly set. Returns whether all stores support this index or not</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td><code>str</code></td>
<td>single key to index</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>unique</code></td>
<td><code>bool</code></td>
<td>Whether or not this index contains only unique keys</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>bool indicating if the index exists/was created on all stores</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.groupby"><code class="codehilite"><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.groupby" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple grouping function that will group documents</span>
<span class="sd">        by keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            keys: fields to group documents</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            generator returning tuples of (dict, list of docs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>

        <span class="n">docs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stores</span><span class="p">:</span>
            <span class="n">temp_docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">store</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                    <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
                    <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span>
                    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                    <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
                    <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span>
                    <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">temp_docs</span><span class="p">:</span>
                <span class="n">docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">key_set</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
            <span class="s2">&quot;index function based on passed in keys&quot;</span>
            <span class="n">test_d</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">test_d</span>

        <span class="n">sorted_docs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key_set</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vals</span><span class="p">,</span> <span class="n">group_iter</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">sorted_docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key_set</span><span class="p">):</span>
            <span class="n">id_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">vals</span><span class="p">)}</span>
            <span class="k">yield</span> <span class="n">id_dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">group_iter</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Simple grouping function that will group documents
by keys.</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keys</code></td>
<td><code>Union[List[str], str]</code></td>
<td>fields to group documents</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Iterator[Tuple[Dict, List[Dict]]]</code></td>
<td>generator returning tuples of (dict, list of docs)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.name"><code class="codehilite"><span class="n">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>331
332
333
334
335
336</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A string representing this data source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compound_name</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">store</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stores</span><span class="p">])</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Concat[</span><span class="si">{compound_name}</span><span class="s2">]&quot;</span>
</pre></div>
</td></tr></table>

</details>
<p>A string representing this data source</p>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.query"><code class="codehilite"><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.query" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Queries across all Store for a set of documents</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to search in</span>
<span class="sd">            properties: properties to return in grouped documents</span>
<span class="sd">            sort: Dictionary of sort order for fields</span>
<span class="sd">            skip: number documents to skip</span>
<span class="sd">            limit: limit on total number of documents returned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: skip, sort and limit are broken. implement properly</span>
        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stores</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">store</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">d</span>
</pre></div>
</td></tr></table>

</details>
<p>Queries across all Store for a set of documents</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.remove_docs"><code class="codehilite"><span class="n">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.remove_docs" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>503
504
505
506
507
508
509
510</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove docs matching the query dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: query dictionary to match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No remove_docs method for JointStore&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Remove docs matching the query dictionary</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Dict</code></td>
<td>query dictionary to match</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.ConcatStore.update"><code class="codehilite"><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.ConcatStore.update" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>374
375
376
377
378
379
380
381
382
383
384
385
386</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update documents into the Store</span>
<span class="sd">        Not implemented in ConcatStore</span>

<span class="sd">        Args:</span>
<span class="sd">            docs: the document or list of documents to update</span>
<span class="sd">            key: field name(s) to determine uniqueness for a</span>
<span class="sd">                 document, can be a list of multiple fields,</span>
<span class="sd">                 a single field, or None if the Store&#39;s key</span>
<span class="sd">                 field is to be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No update method for ConcatStore&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Update documents into the Store
Not implemented in ConcatStore</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>docs</code></td>
<td><code>Union[List[Dict], Dict]</code></td>
<td>the document or list of documents to update</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>key</code></td>
<td><code>Optional[Union[List, str]]</code></td>
<td>field name(s) to determine uniqueness for a document, can be a list of multiple fields, a single field, or None if the Store's key field is to be used</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="maggma.stores.compound_stores.JointStore"><code class="codehilite"><span class="n">JointStore</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore" title="Permanent link">&para;</a></h2>
<div class="autodoc">
<p>Store that implements a on-the-fly join across multiple collections all in the same MongoDB database.
This is a Read-Only Store designed to combine data from multiple collections.</p>
<h3 id="maggma.stores.compound_stores.JointStore.last_updated"><code class="codehilite"><span class="n">last_updated</span><span class="p">:</span> <span class="n">datetime</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.last_updated" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p>Special last_updated for this JointStore
that checks all underlying collections</p>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.nonmaster_names"><code class="codehilite"><span class="n">nonmaster_names</span><span class="p">:</span> <span class="n">List</span></code> <em>(property, readonly)</em><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.nonmaster_names" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<p>alll non-master collection names</p>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.__eq__"><code class="codehilite"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.__eq__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check equality for JointStore</span>
<span class="sd">        Args:</span>
<span class="sd">            other: other JointStore to compare with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">JointStore</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;database&quot;</span><span class="p">,</span>
            <span class="s2">&quot;collection_names&quot;</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">,</span>
            <span class="s2">&quot;port&quot;</span><span class="p">,</span>
            <span class="s2">&quot;master&quot;</span><span class="p">,</span>
            <span class="s2">&quot;merge_at_root&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Check equality for JointStore
<strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code>object</code></td>
<td>other JointStore to compare with</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.__init__"><code class="codehilite"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">collection_names</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">27017</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">merge_at_root</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.__init__" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">collection_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">27017</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">master</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">merge_at_root</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            database: The database name</span>
<span class="sd">            collection_names: list of all collections</span>
<span class="sd">                to join</span>
<span class="sd">            host: Hostname for the database</span>
<span class="sd">            port: TCP port to connect to</span>
<span class="sd">            username: Username for the collection</span>
<span class="sd">            password: Password to connect with</span>
<span class="sd">            master: name for the master collection</span>
<span class="sd">                if not specified this defaults to the first</span>
<span class="sd">                in collection_names list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_names</span> <span class="o">=</span> <span class="n">collection_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Any</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span> <span class="o">=</span> <span class="n">master</span> <span class="ow">or</span> <span class="n">collection_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_at_root</span> <span class="o">=</span> <span class="n">merge_at_root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">JointStore</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>database</code></td>
<td><code>str</code></td>
<td>The database name</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>collection_names</code></td>
<td><code>List[str]</code></td>
<td>list of all collections to join</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>host</code></td>
<td><code>str</code></td>
<td>Hostname for the database</td>
<td><code>'localhost'</code></td>
</tr>
<tr>
<td><code>port</code></td>
<td><code>int</code></td>
<td>TCP port to connect to</td>
<td><code>27017</code></td>
</tr>
<tr>
<td><code>username</code></td>
<td><code>str</code></td>
<td>Username for the collection</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>password</code></td>
<td><code>str</code></td>
<td>Password to connect with</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>master</code></td>
<td><code>Optional[str]</code></td>
<td>name for the master collection if not specified this defaults to the first in collection_names list</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.close"><code class="codehilite"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.close" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>79
80
81
82
83</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes underlying database connections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table>

</details>
<p>Closes underlying database connections</p>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.connect"><code class="codehilite"><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.connect" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects the underlying Mongo database and</span>
<span class="sd">        all collection connections</span>

<span class="sd">        Args:</span>
<span class="sd">            force_reset: whether to forcibly reset the connection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_merge_objects</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">server_info</span><span class="p">()[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s2">&quot;3.6&quot;</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Connects the underlying Mongo database and
all collection connections</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>force_reset</code></td>
<td><code>bool</code></td>
<td>whether to forcibly reset the connection</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.count"><code class="codehilite"><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.count" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>215
216
217
218
219
220
221
222
223
224
225</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of documents matching the query criteria</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: PyMongo filter for documents to count in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pipeline</span><span class="p">(</span><span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;$count&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</pre></div>
</td></tr></table>

</details>
<p>Counts the number of documents matching the query criteria</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to count in</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.ensure_index"><code class="codehilite"><span class="n">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.ensure_index" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>130
131
132
133
134</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">ensure_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Can&#39;t ensure index for JointStore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No ensure_index method for JointStore&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Can't ensure index for JointStore</p>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.groupby"><code class="codehilite"><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.groupby" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]]:</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pipeline</span><span class="p">(</span>
            <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>
        <span class="n">group_id</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str,Any]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">set_</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$push&quot;</span><span class="p">:</span> <span class="s2">&quot;$$ROOT&quot;</span><span class="p">}}})</span>

        <span class="n">agg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">agg</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;docs&quot;</span><span class="p">]</span>
</pre></div>
</td></tr></table>

</details>
<p>Simple grouping function that will group documents
by keys.</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keys</code></td>
<td><code>Union[List[str], str]</code></td>
<td>fields to group documents</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Iterator[Tuple[Dict, List[Dict]]]</code></td>
<td>generator returning tuples of (dict, list of docs)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.name"><code class="codehilite"><span class="n">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.name" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>55
56
57
58
59
60</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string representing this data source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compound_name</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Compound[</span><span class="si">{self.host}</span><span class="s2">/</span><span class="si">{self.database}</span><span class="s2">][</span><span class="si">{compound_name}</span><span class="s2">]&quot;</span>
</pre></div>
</td></tr></table>

</details>
<p>Return a string representing this data source</p>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.query"><code class="codehilite"><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.query" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>227
228
229
230
231
232
233
234
235
236
237
238
239
240</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">criteria</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sort</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pipeline</span><span class="p">(</span>
            <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
        <span class="p">)</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">agg</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">d</span>
</pre></div>
</td></tr></table>

</details>
<p>Queries the Store for a set of documents</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Optional[Dict]</code></td>
<td>PyMongo filter for documents to search in</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>properties</code></td>
<td><code>Optional[Union[Dict, List]]</code></td>
<td>properties to return in grouped documents</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td><code>Optional[Dict[str, maggma.core.store.Sort]]</code></td>
<td>Dictionary of sort order for fields</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>skip</code></td>
<td><code>int</code></td>
<td>number documents to skip</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td><code>int</code></td>
<td>limit on total number of documents returned</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.query_one"><code class="codehilite"><span class="n">query_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.query_one" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">query_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get one document</span>

<span class="sd">        Args:</span>
<span class="sd">            properties: properties to return in query</span>
<span class="sd">            criteria: filter for matching</span>
<span class="sd">            kwargs: kwargs for collection.aggregate</span>

<span class="sd">        Returns:</span>
<span class="sd">            single document</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: maybe adding explicit limit in agg pipeline is better as below?</span>
        <span class="c1"># pipeline = self._get_pipeline(properties, criteria)</span>
        <span class="c1"># pipeline.append({&quot;$limit&quot;: 1})</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">doc</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</td></tr></table>

</details>
<p>Get one document</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>properties</code></td>
<td><code>_empty</code></td>
<td>properties to return in query</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>criteria</code></td>
<td><code>_empty</code></td>
<td>filter for matching</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>**kwargs</code></td>
<td><code>_empty</code></td>
<td>kwargs for collection.aggregate</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_empty</code></td>
<td>single document</td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.remove_docs"><code class="codehilite"><span class="n">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.remove_docs" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>288
289
290
291
292
293
294
295</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove docs matching the query dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: query dictionary to match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No remove_docs method for JointStore&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Remove docs matching the query dictionary</p>
<p><strong>Parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>criteria</code></td>
<td><code>Dict</code></td>
<td>query dictionary to match</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</div>
<h3 id="maggma.stores.compound_stores.JointStore.update"><code class="codehilite"><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">update_lu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code><a class="headerlink" href="#maggma.stores.compound_stores.JointStore.update" title="Permanent link">&para;</a></h3>
<div class="autodoc">
<details class="note"><summary>Show source code in maggma/stores/compound_stores.py</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>115
116
117
118
119
120</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">update_lu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update documents into the underlying collections</span>
<span class="sd">        Not Implemented for JointStore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;JointStore is a read-only store&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

</details>
<p>Update documents into the underlying collections
Not Implemented for JointStore</p>
</div>
</div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../core_validator/" title="Validator" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Validator
              </span>
            </div>
          </a>
        
        
          <a href="../builders/" title="Builders" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Builders
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Built by The Materials Project
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>